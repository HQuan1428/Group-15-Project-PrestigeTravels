{{#if successMessage}}
<div id="successMessage" class="alert alert-success">
    {{successMessage}}
</div>
{{/if}}

{{#if errorMessage}}
<div id="errorMessage" class="alert alert-danger">
    {{errorMessage}}
</div>
{{/if}}
<div class="d-flex align-items-start">
    <div class="flex-grow-1">
        <h2 class="my-4">Xét duyệt dịch vụ </h2>
        <div class="input-group rounded" style="gap: 10px; margin-top: 20px;">
            <!-- Form tìm kiếm -->
            <form action="/admin/approvals/search" method="POST" class="d-flex align-items-center w-100">
                <input type="search" name="name" class="form-control rounded shadow-sm border-primary"
                    placeholder="Search tên dịch vụ" aria-label="Search" aria-describedby="search-addon" />
                <button type="submit" class="btn btn-primary ms-2 px-3 shadow-sm"><i class="fas fa-search"></i></button>
            </form>
        </div>
        <table class="table table-striped table-bordered table-hover" style="margin-top:10px; margin-bottom:10px ">
            <thead class="thead-light">
                <tr>
                    <th scope="col">Tên du lịch</th>
                    <th scope="col">Tên nhà cung cấp </th>
                    <th scope="col">Danh mục </th>
                    <th scope="col">Ngày gửi </th>
                    <th scope="col">Trạng thái </th>
                    <th scope="col">Detail</th>
                    <th scope="col">Chấp nhận & từ chối</th>
                </tr>
            </thead>
            <tbody id="approvalsTable">
                <!-- Hiển thị tài khoản -->
            </tbody>
        </table>
        <!-- Phân trang -->
        <nav aria-label="Pagination">
            <ul class="pagination justify-content-end" id="pagination">
            </ul>
        </nav>

    </div>
</div>
<style>
    .form-control:hover,
    .form-control:focus {
        border-color: #0d6efd;
        box-shadow: 0 0 8px rgba(13, 110, 253, 0.5);
    }

    .btn-primary:hover {
        background-color: #0b5ed7;
        border-color: #0a58ca;
        transform: scale(1.05);
        transition: all 0.2s ease-in-out;
    }

    .btn-success:hover {
        background-color: #157347;
        border-color: #146c43;
        transform: scale(1.05);
        transition: all 0.2s ease-in-out;
    }

    .hover-add-btn i {
        margin-right: 5px;
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', () => {
            // Dữ liệu người dùng
            const approvals = {{{ json approvals }}};
        const approvalsPerPage = 10;
        let currentPage = 1;

        function displayApprovals(page) {
            // Kiểm tra nếu không có tài khoản
            if (approvals.length === 0) {
                document.getElementById('approvalsTable').innerHTML = '<tr><td colspan="6">Không có dịch vụ nào!</td></tr>';
                document.getElementById('pagination').innerHTML = '';
                return;
            }

            // Tính toán chỉ số bắt đầu và kết thúc
            const start = (page - 1) * approvalsPerPage;
            const end = start + approvalsPerPage;
            const approvalsToDisplay = approvals.slice(start, end);

            // Cập nhật bảng
            const tableBody = document.getElementById('approvalsTable');
            tableBody.innerHTML = ''; // Xóa nội dung bảng cũ

            approvalsToDisplay.forEach(approval => {
                const row = document.createElement('tr');
                row.innerHTML = `
                <td>${approval.title}</td>
                <td>${approval.company_name}</td>
                <td>${approval.duration}</td>
                <td>${approval.created_at}</td>
                <td>${approval.status}</td>
                <td> <a href="/admin/approvals/detail/${approval.id}">xem thêm </a></td>
                <td>
                    <form action="/admin/approvals/delete/${approval.id}" method="POST" style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-danger">Xóa</button>
                    </form>
                    <form action="/admin/approvals/reject/${approval.id}" method="POST" style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-danger">Từ chối</button>
                    </form>

                </td>
            `;
                tableBody.appendChild(row);
            });

            // Hiển thị phân trang
            displayPagination(page);
        }

        function displayPagination(page) {
            const totalPages = Math.ceil(approvals.length / approvalsPerPage);
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = ''; // Xóa nội dung phân trang cũ

            // Nút Previous
            if (page > 1) {
                pagination.innerHTML += `<li class="page-item"><a class="page-link" href="#" onclick="goToPage(${page - 1})"><<</a></li>`;
            }

            // Các nút số trang
            for (let i = 1; i <= totalPages; i++) {
                pagination.innerHTML += `
                <li class="page-item ${i === page ? 'active' : ''}">
                    <a class="page-link" href="#" onclick="goToPage(${i})">${i}</a>
                </li>
            `;
            }

            // Nút Next
            if (page < totalPages) {
                pagination.innerHTML += `<li class="page-item"><a class="page-link" href="#" onclick="goToPage(${page + 1})">>></a></li>`;
            }
        }

        function goToPage(page) {
            currentPage = page;
            displayApprovals(page); // Sửa từ displayAccounts thành displayApprovals
        }

        window.goToPage = goToPage;

        // Hiển thị trang đầu tiên
        displayApprovals(currentPage); // Sửa từ displayAccounts thành displayApprovals
});

</script>