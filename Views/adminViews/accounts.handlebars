{{#if successMessage}}
    <div id="successMessage" class="alert alert-success">
        {{successMessage}}
    </div>
{{/if}}

{{#if errorMessage}}
    <div id="errorMessage" class="alert alert-danger">
        {{errorMessage}}
    </div>
{{/if}}
<div class="d-flex align-items-start">
    <div class="flex-grow-1">
        <h2 class="my-4">Quản lý tài khoản</h2>
        <div class="input-group rounded" style="gap: 10px; margin-top: 20px;">
            <!-- Form tìm kiếm -->
            <form action="/admin/search" method="POST" class="d-flex align-items-center w-100">
                <input type="search" name="name" class="form-control rounded shadow-sm border-primary"
                    placeholder="Search name user" aria-label="Search" aria-describedby="search-addon" />
                <button type="submit" class="btn btn-primary ms-2 px-3 shadow-sm"><i class="fas fa-search"></i></button>
            </form>
            <!-- Nút thêm tài khoản -->
            <button id="toggleFormButton" class="btn btn-success shadow-sm px-3 py-2">
                <i class="fas fa-user-plus"></i> Add account
            </button>
        </div>
        <!-- Form thêm tài khoản (ẩn ban đầu) -->
        <form id="addUserForm" method="POST" action="/admin/adduser" class="p-4 shadow rounded bg-light mt-4"
            style="max-width: 500px; margin: auto; display: none;">
            <h3 class="text-center mb-4">Thêm người dùng</h3>
            <div class="mb-3">
                <label for="name" class="form-label">Tên</label>
                <input type="text" id="name" name="fullname" class="form-control" placeholder="Nhập tên" required />
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" id="email" name="email" class="form-control" placeholder="Nhập email" required />
            </div>
            <div class="mb-3">
                <label for="phone" class="form-label">Số điện thoại</label>
                <input type="text" id="phone" name="phone" class="form-control" placeholder="Nhập số điện thoại"
                    required />
            </div>
            <div class="mb-3">
                <label for="role" class="form-label">Vai trò</label>
                <select id="role" name="role" class="form-select" required>
                    <option value="customer">Customer</option>
                    <option value="partner">Partner</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Mật khẩu</label>
                <input type="password" id="password" name="password" class="form-control" placeholder="Nhập mật khẩu"
                    required />
            </div>
            <div class="d-grid">
                <button type="submit" class="btn btn-success">Thêm người dùng</button>
            </div>
        </form>

        <table class="table table-striped table-bordered table-hover" style="margin-top:10px; margin-bottom:10px ">
            <thead class="thead-light">
                <tr>
                    <th scope="col">Tên</th>
                    <th scope="col">Email</th>
                    <th scope="col">Số điện thoại</th>
                    <th scope="col">Loại tài khoản</th>
                    <th scope="col">Ngày đăng kí</th>
                    <th scope="col">Delete</th>
                </tr>
            </thead>
            <tbody id="accountTable">
                <!-- Hiển thị tài khoản -->
            </tbody>
        </table>
        <!-- Phân trang -->
        <nav aria-label="Pagination">
            <ul class="pagination justify-content-end" id="pagination">
            </ul>
        </nav>

    </div>
</div>
<style>
    .form-control:hover,
    .form-control:focus {
        border-color: #0d6efd;
        box-shadow: 0 0 8px rgba(13, 110, 253, 0.5);
    }

    .btn-primary:hover {
        background-color: #0b5ed7;
        border-color: #0a58ca;
        transform: scale(1.05);
        transition: all 0.2s ease-in-out;
    }

    .btn-success:hover {
        background-color: #157347;
        border-color: #146c43;
        transform: scale(1.05);
        transition: all 0.2s ease-in-out;
    }

    .hover-add-btn i {
        margin-right: 5px;
    }
</style>
<script>
    // Đảm bảo rằng mã JavaScript chỉ chạy sau khi DOM đã tải xong
    document.addEventListener('DOMContentLoaded', () => {
        // Dữ liệu người dùng
        const accounts = {{{ json accounts }}};
            const accountsPerPage = 10;
            let currentPage = 1;

            function displayAccounts(page) {
                console.log("Chuyển đến trang:", page);

                // Kiểm tra nếu không có tài khoản
                if (accounts.length === 0) {
                    document.getElementById('accountTable').innerHTML = '<tr><td colspan="6">Không có tài khoản nào!</td></tr>';
                    document.getElementById('pagination').innerHTML = '';
                    return;
                }

                // Tính toán chỉ số bắt đầu và kết thúc
                const start = (page - 1) * accountsPerPage;
                const end = start + accountsPerPage;
                const accountsToDisplay = accounts.slice(start, end);

                // Cập nhật bảng
                const tableBody = document.getElementById('accountTable');
                tableBody.innerHTML = ''; // Xóa nội dung bảng cũ

                accountsToDisplay.forEach(account => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${account.fullname}</td>
                <td>${account.email}</td>
                <td>${account.phone}</td>
                <td>${account.role}</td>
                <td>${account.created_at}</td>
                <td>
                <form action="/admin/delete/${account.id}" method="POST" style="display:inline;">
                    <button type="submit" class="btn btn-sm btn-danger">Xóa</button>
                </form>
            </td>
        `;
                    tableBody.appendChild(row);
                });

                // Hiển thị phân trang
                displayPagination(page);
            }

            function displayPagination(page) {
                const totalPages = Math.ceil(accounts.length / accountsPerPage);
                const pagination = document.getElementById('pagination');
                pagination.innerHTML = ''; // Xóa nội dung phân trang cũ

                // Nút Previous
                if (page > 1) {
                    pagination.innerHTML += `<li class="page-item"><a class="page-link" href="#" onclick="goToPage(${page - 1})"><<</a></li>`;
                }

                // Các nút số trang
                for (let i = 1; i <= totalPages; i++) {
                    pagination.innerHTML += `
            <li class="page-item ${i === page ? 'active' : ''}">
                <a class="page-link" href="#" onclick="goToPage(${i})">${i}</a>
            </li>
        `;
                }

                // Nút Next
                if (page < totalPages) {
                    pagination.innerHTML += `<li class="page-item"><a class="page-link" href="#" onclick="goToPage(${page + 1})">>></a></li>`;
                }
            }

            function goToPage(page) {
                console.log("Chuyển đến trang:", page);
                currentPage = page;
                displayAccounts(page);
            }
            window.goToPage = goToPage;

            // Hiển thị trang đầu tiên
            displayAccounts(currentPage);


        // AddUser form toggle
        const toggleFormButton = document.getElementById('toggleFormButton');
        const addUserForm = document.getElementById('addUserForm');
        // Gắn sự kiện click vào nút
        toggleFormButton.addEventListener('click', () => {
            // Kiểm tra trạng thái hiển thị của form
            if (addUserForm.style.display === 'none' || addUserForm.style.display === '') {
                addUserForm.style.display = 'block'; // Hiển thị form
            } else {
                addUserForm.style.display = 'none'; // Ẩn form
            }
        });
        window.onload = function() {
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            if (successMessage) {
                setTimeout(() => {
                    successMessage.style.display = 'none';
                }, 2000);
            }
            if (errorMessage) {
                setTimeout(() => {
                    errorMessage.style.display = 'none';
                }, 2000);
            }
        };
    });
</script>