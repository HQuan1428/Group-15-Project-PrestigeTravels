<style>
    .order-header,
    .payment-info {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 15px;
        margin-bottom: 20px;
    }

    .status {
        color: #fff;
        background-color: #f0ad4e;
        padding: 5px 10px;
        border-radius: 3px;
        font-size: 14px;
    }

    .btn-copy {
        cursor: pointer;
        background: none;
        border: none;
        color: #007bff;
        text-decoration: underline;
    }

    .table td,
    .table th {
        vertical-align: middle;
    }

    /* CSS đi kèm để demo */
    #notification {
        position: fixed;
        top: -100px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #4CAF50;
        color: white;
        padding: 15px 30px;
        border-radius: 5px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: top 0.5s ease-out;
        z-index: 1000;
    }

    #notification.show {
        top: 20px;
    }

    .hidden {
        display: none;
    }
</style>

<div id="notification" class="hidden">
    <p>Thanh toán thành công!</p>
</div>

<div class="container mt-5">
    <!-- Order Header -->
    <div class="order-header">
        <h5>ĐƠN HÀNG</h5>
        <div class="row">
            <div class="col-md-4">
                <strong>Mã đơn #:</strong>
                <span>{{paymentInfo.booking_id}}</span>
            </div>
            <div class="col-md-4">
                <strong>Số tiền:</strong>
                <span id="amount" >₫0</span>
            </div>
            <div class="col-md-4">
                <strong>TT hóa đơn:</strong>
                <span class="status" id="paymentStatus">Chưa thanh toán</span>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-md-6">
                <strong>Ngày tạo:</strong>
                <span>{{dateTime}}</span>
            </div>
        </div>
    </div>

    <!-- Product Information -->
    <div class="order-header">
        <h5>Thông tin sản phẩm</h5>
        <table class="table table-bordered">
            <thead class="table-light">
                <tr>
                    <th>Tên sản phẩm</th>
                    <th>Số lượng</th>
                    <th>Trạng thái</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{detail.title}}</td>
                    <td>{{numbers}}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Payment Information -->
    <div class="payment-info">
        <h5>THÔNG TIN THANH TOÁN</h5>
        <table class="table table-bordered">
            <tbody>
                <tr>
                    <td><strong>Ngân hàng:</strong></td>
                    <td>Chuyển khoản ngân hàng </td>
                </tr>
                <tr>
                    <td><strong>Số tài khoản:</strong></td>
                    <td>
                        {{bankAccount}}
                        <button class="btn btn-primary btn-rectangle"
                            onclick="copyToClipboard('{{bankAccount}}')">copy</button>
                    </td>
                </tr>
                <tr>
                    <td><strong>Tên tài khoản:</strong></td>
                    <!-- Chỗ này cũng sửa lại -->
                    <td>NGUYEN HAI QUAN / VIETCOMBANK </td>
                </tr>
                <tr>
                    <td><strong>Số tiền:</strong></td>
                    <td>{{paymentInfo.amount}}</td>
                </tr>
                <tr>
                    <td><strong>Nội dung thanh toán:</strong></td>
                    <!-- Tạo định dạng cho nội dung thanh toán -->
                    <td>Tour: {{tour_id}} {{detail.title}}
                        <button class="btn btn-primary btn-rectangle"
                            onclick="copyToClipboard('Tour: {{tour_id}} {{detail.title}}')">copy</button>
                    </td>

                </tr>
                <tr>
                    <td><strong>Mã QR:</strong></td>
                    <td>
                        <img src="/QRpay/QRcode.jpg" alt="QR Code" class="img-fluid" style="max-width: 150px;">
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    function updateSummary() {
        const price = "{{paymentInfo.amount}}";
        document.getElementById('amount').textContent = '₫' + parseFloat(price).toLocaleString('vi-VN');
    }
    document.addEventListener("DOMContentLoaded", updateSummary);
</script>

<script>

    function updatePaymentStatus() {
        const statusElement = document.getElementById('paymentStatus');

        // Thay đổi nội dung và màu nền của thẻ
        statusElement.textContent = 'Đã thanh toán';
        statusElement.style.backgroundColor = 'green'; // Màu nền xanh
        statusElement.style.color = 'white'; // Chữ màu trắng
    }

    function showNotification() {
        const notification = document.getElementById('notification');

        // Hiển thị bảng và kích hoạt animation
        notification.classList.remove('hidden');
        setTimeout(() => {
            notification.classList.add('show');
        }, 10); // Thêm độ trễ nhỏ để đảm bảo transition hoạt động

        // Ẩn bảng sau 3 giây
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 500); // Chờ cho animation kết thúc trước khi ẩn
        }, 3000);
    }



    function checkPaymentStatus() {
        const tour_id = "{{tour_id}}";
        fetch(`/status/${tour_id}`)
            .then(response => response.json())
            .then(data => {
                if (data.status === 'confirmed') {
                    updatePaymentStatus();
                    // Hiển thị thông báo thanh toán thành công
                    showNotification();


                    // Chuyển hướng tới trang chủ sau 3.5 giây
                    setTimeout(() => {
                        window.location.href = '/customer'; // Đường dẫn trang chủ
                    }, 3500); // 3.5 giây cho người dùng xem thông báo
                }
            })
            .catch(error => {
                console.error('Lỗi khi kiểm tra trạng thái thanh toán:', error);
            });
    }

    document.addEventListener("DOMContentLoaded", setInterval(checkPaymentStatus, 5000))
</script>

<script>
    function copyToClipboard(text) {
        if (!navigator.clipboard) {
            alert('Trình duyệt của bạn không hỗ trợ Clipboard API.');
            return;
        }

        navigator.clipboard.writeText(text)
            .then(() => {
                alert('Đã sao chép: ' + text);
            })
            .catch((err) => {
                console.error('Lỗi khi sao chép vào clipboard:', err);
                alert('Không thể sao chép vào clipboard. Vui lòng thử lại.');
            });
    }
</script>